<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#7c5cff" />
  <meta name="application-name" content="Meet" />
  <meta name="description" content="Meet  lightweight P2P video meeting (3-4 users). Frontend-ready for hosting on GitHub Pages. Signaling: Firebase/Firestore." />

  <title>Meet  P2P Video Meeting</title>

  <!-- Preconnect for Firebase / Google resources -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.googleapis.com" crossorigin>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Favicons / Apple icon -->
  <link rel="icon" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="assets/css/style.css">

  <!-- Minimal inline fallback so layout stays readable without CSS -->
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    #app{max-width:1100px;margin:0 auto;padding:18px}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
    /* basic grid for videos (style.css should override) */
    .videos { display: grid; gap: 12px; grid-auto-rows: var(--tile-height, 200px); }
    .vid { background: #111; color: #fff; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:8px; position:relative; }
    .vid video { width:100%; height:100%; object-fit:cover; display:block; }
    .name { position:absolute; left:8px; bottom:8px; background:rgba(0,0,0,0.45); padding:6px 8px; border-radius:6px; font-size:13px; }
    #shareUrl { margin-top:8px; font-size:12px; word-break:break-all; }
  </style>
</head>
<body>
  <!-- Skip link for keyboard users -->
  <a href="#main" class="visually-hidden" aria-hidden="false">Skip to main content</a>

  <div id="app" class="app-root" role="application" aria-labelledby="app-title">

    <!-- Header -->
    <header role="banner" class="site-header">
      <div class="brand" aria-hidden="false">
        <h1 id="app-title">Meet <small aria-hidden="true">P2P Mesh (3‚Äì4 users)</small></h1>
      </div>

      <div class="meta" aria-hidden="true">
        <p class="visually-hidden" id="description">Frontend hosted on GitHub Pages. Recommended signaling: Firebase Firestore.</p>
      </div>
    </header>

    <!-- Main: left column (controls + videos) + right sidebar (profile, chat, status) -->
    <main id="main" role="main" tabindex="-1" style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;">

      <!-- Left column -->
      <div class="left-column" style="flex:1 1 640px;min-width:320px;">

        <!-- Room controls -->
        <section aria-labelledby="room-controls-title" class="room-controls card" id="room-controls">
          <h2 id="room-controls-title" class="visually-hidden">Room Controls</h2>

          <form id="roomForm" class="room-form" autocomplete="off" role="search" aria-label="Join or create meeting room" novalidate>
            <div class="form-field">
              <label for="roomId" class="label">Room ID</label>
              <input id="roomId" name="room" type="text" inputmode="text" placeholder="e.g. team-weekly-sync" aria-describedby="roomHint" required data-hook="room-id" />
            </div>

            <div class="actions" aria-hidden="false" style="margin-top:8px;display:flex;gap:8px;">
              <button type="button" id="createRoom" data-hook="create-room" class="button primary" aria-pressed="false">Create / Join</button>
              <button type="button" id="leaveRoom" data-hook="leave-room" class="button danger" disabled aria-pressed="false">Leave</button>
            </div>

            <div id="shareUrl" class="share-url visually-hidden" aria-live="polite"></div>
          </form>
        </section>

        <!-- Video grid and controls -->
        <section aria-labelledby="video-section-title" class="video-section card" id="video-section">
          <h2 id="video-section-title" class="visually-hidden">Video Conference</h2>

          <div id="videos" class="videos" role="list" aria-label="Video tiles" tabindex="0">
            <!-- JS will mount <div class="vid"> elements here -->
          </div>

          <div class="controls" role="group" aria-label="Meeting controls">
            <button id="toggleMic" data-hook="toggle-mic" aria-pressed="false" title="Toggle microphone" class="button">üéôÔ∏è Mic</button>
            <button id="toggleCam" data-hook="toggle-cam" aria-pressed="false" title="Toggle camera" class="button">üé• Cam</button>
            <button id="shareScreen" data-hook="share-screen" aria-pressed="false" title="Share your screen" class="button">üñ•Ô∏è Share Screen</button>
          </div>
        </section>

      </div> <!-- end left-column -->

      <!-- Sidebar: display name, chat, status
      <aside class="sidebar" aria-labelledby="sidebar-title" id="sidebar" role="complementary">
        <h2 id="sidebar-title" class="visually-hidden">Sidebar</h2>

        <div class="card profile" aria-labelledby="profile-title">
          <h3 id="profile-title" class="visually-hidden">Profile</h3>
          <label for="displayName" class="label">Display Name</label>
          <input id="displayName" type="text" name="displayName" placeholder="Your name" data-hook="display-name" />
          <p class="hint">This name will be shown on your video tile.</p>
        </div> -->

        <div class="card chat" aria-labelledby="chat-title">
          <h3 id="chat-title">Chat</h3>

          <!-- Chat log -->
          <div id="chatBox" class="chat-box" role="log" aria-live="polite" aria-atomic="false"></div>

          <!-- Chat form: use submit for keyboard accessibility; JS should preventDefault and handle sending -->
          <form id="chatForm" class="chat-form" action="#" autocomplete="off" novalidate>
            <label for="chatInput" class="visually-hidden">Type message</label>
            <input id="chatInput" type="text" name="message" placeholder="Type a message‚Ä¶" data-hook="chat-input" aria-label="Type a message" />
            <button id="sendChat" type="submit" data-hook="send-chat" class="button primary">Send</button>
          </form>
        </div>

        <div class="card status" aria-labelledby="status-title">
          <h3 id="status-title" class="visually-hidden">Status</h3>
          <label class="label">Status</label>
          <div id="status" data-hook="status" role="status" aria-live="polite">Idle</div>
          <p class="small">Tip: Mesh is best for 3‚Äì4 participants. For larger groups consider an SFU (e.g. Jitsi/mediasoup).</p>
        </div>
      </aside>

    </main>

    <!-- Footer -->
    <footer role="contentinfo" class="site-footer" style="margin-top:18px">
      <p class="small">Meet  lightweight frontend demo. <strong>Do not</strong> store sensitive data in Firestore without proper security rules.</p>
    </footer>

    <!-- Templates used by JS to render tiles -->
    <template id="video-tile-template">
      <div class="vid" role="listitem" data-peer="">
        <video autoplay playsinline muted></video>
        <div class="name" data-hook="video-name" aria-hidden="false"></div>
        <div class="badges" aria-hidden="true">
          <span class="badge mute" data-hook="badge-mute"></span>
        </div>
      </div>
    </template>

    <!-- NoScript -->
    <noscript>
      <div class="noscript card">
        <p>JavaScript is required to run Meet. Please enable JavaScript and reload the page.</p>
      </div>
    </noscript>

  </div> <!-- end #app -->

  <!-- Service Worker registration (di-load terakhir) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('SW registered:', reg.scope))
          .catch(err => console.warn('SW registration failed:', err));
      });
    }
  </script>

  <!-- App script (module) -->
  <script type="module" src="assets/js/app.js" defer></script>
</body>
</html>
